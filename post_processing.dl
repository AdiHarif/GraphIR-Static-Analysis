
#include "type_inference.dl"
#include "arrays.dl"
#include "points_to.dl"

.decl full_type(vertex: number, type: symbol)

.decl primitive_type_conversion(source_type: symbol, target_type: symbol)
primitive_type_conversion("number", "Float64").
primitive_type_conversion("boolean", "Integer1").

full_type(v, target) :-
    inferred_type(v, source),
    primitive_type_conversion(source, target).

full_type(v, cat("DynamicArray<", cat(element_type,">"))) :-
    inferred_type(v, "Array"),
    may_refer_to(v, alloc),
    array_element_type(alloc, source_type),
    primitive_type_conversion(source_type, element_type).

full_type(v, cat("DynamicArray<", cat(element_type,">"))) :-
    inferred_type(v, "Array"),
    may_refer_to(v, alloc),
    points_to(alloc, element, _),
    full_type(element, element_type).

.output full_type()
